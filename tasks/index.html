<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Quest - Спасение Робота Питона</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/level1.css">
    <link rel="stylesheet" href="css/level2.css">
    <link rel="stylesheet" href="css/level3.css">
    <link rel="stylesheet" href="css/level4.css">
    <link rel="stylesheet" href="css/level5.css">
    <link rel="stylesheet" href="css/level6.css">
    <link rel="stylesheet" href="css/level7.css">
</head>
<body>
    <!-- Прогресс бар -->
    <div class="progress-container">
        <div class="progress-header">
            <div class="progress-label">Прогресс квеста</div>
            <div class="level-number">Уровень 1/5</div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: 20%;"></div>
        </div>
        <div style="margin-top: 15px; display: flex; justify-content: space-between;">
            <button class="btn btn-small btn-secondary" onclick="resetProgress()">
                Сбросить
            </button>
            <button class="btn btn-small btn-secondary" onclick="showProgressStats()">
                Статистика
            </button>
        </div>
    </div>

    <!-- Контейнер для уровней -->
    <div id="level-container">
        <!-- Уровни будут загружаться сюда -->
    </div>

    <!-- Модальное окно -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modal-text"></div>
        </div>
    </div>

    <!-- Аудио элементы -->
    <audio id="sound-click" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-success" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-error" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>

    <!-- Подключаем JavaScript -->
    <script src="js/main.js"></script>
    <script src="js/progress.js"></script>
    <script src="js/level1.js"></script>
    <script src="js/level2.js"></script>
    <script src="js/level3.js"></script>
    <script src="js/level4.js"></script>
    <script src="js/level5.js"></script>
    <script src="js/level6.js"></script>
    <script src="js/level7.js"></script>
    <script src="js/code-protection.js"></script>

    <script>
        // Автоматический запуск
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Code Quest загружается...');
            
            // Проверяем наличие прогресса
            const progress = JSON.parse(localStorage.getItem('codeQuestProgress') || '{}');
            let startLevel = 1;
            
            // Если есть незавершенный уровень, загружаем его
            for (let i = 5; i >= 1; i--) {
                if (progress[`level${i}`] && !progress[`level${i}`].completed) {
                    startLevel = i;
                    break;
                }
            }
            
            // Если все 5 уровней пройдены, показываем финал
            if (progress.level5 && progress.level5.completed && !progress.level6) {
                startLevel = 6; // Финальный экран
            }
            
            // Если уже был финал, показываем его
            if (progress.level6) {
                startLevel = 6;
            }
            
            setTimeout(function() {
                if (typeof loadLevel === 'function') {
                    console.log('Начинаем с уровня:', startLevel);
                    loadLevel(startLevel);
                } else {
                    console.error('Функция loadLevel не найдена!');
                    document.getElementById('level-container').innerHTML = `
                        <div class="error">
                            <h2>Ошибка загрузки</h2>
                            <p>Не удалось загрузить игру. Проверьте консоль браузера.</p>
                        </div>
                    `;
                }
            }, 500);
        });
    </script>
</body>
</html>